import json
import os
import random
from pathlib import Path

OUTPUT_FILE = "working_unified.json"

def main():",
"   # Trova tutti i file JSON nella directory corrente",
"   json_files = list(Path(".").glob("*.json"))",
"   ",
"   # Nessuna esclusione: includiamo anche l'output file se esiste",
"   # (cos√¨ non perdiamo i vecchi URL gi√† unificati)",
"   ",
"   if not json_files:",
"       print("‚ùå Nessun file JSON trovato nella directory corrente")",
"       return",
"   ",
"   print(f"Trovati {len(json_files)} file JSON:")",
"   for f in json_files:",
"       print(f"  - {f.name}")",
"   ",
"   # Set per raccogliere tutti gli URL unici",
"   all_urls = set()",
"   ",
"   # Leggi ogni file",
"   for json_file in json_files:",
"       try:",
"           with open(json_file, "r", encoding="utf-8") as f:",
"               data = json.load(f)",
"           ",
"           # Gestisci sia liste che dict con "urls"",
"           if isinstance(data, dict):",
"               urls = data.get("urls", [])",
"           elif isinstance(data, list):",
"               urls = data",
"           else:",
"               print(f"‚ö†Ô∏è  {json_file.name}: formato non riconosciuto, saltato")",
"               continue",
"           ",
"           # Aggiungi gli URL al set",
"           before = len(all_urls)",
"           all_urls.update(urls)",
"           added = len(all_urls) - before",
"           ",
"           print(f"‚úÖ {json_file.name}: {len(urls)} URL totali, {added} nuovi")",
"           ",
"       except json.JSONDecodeError:",
"           print(f"‚ö†Ô∏è  {json_file.name}: non √® un JSON valido, saltato")",
"       except Exception as e:",
"           print(f"‚ö†Ô∏è  {json_file.name}: errore - {e}")",
"   ",
"   # Converti in lista e mescola",
"   unified_list = list(all_urls)",
"   random.shuffle(unified_list)",
"   ",
"   # Salva il risultato",
"   with open(OUTPUT_FILE, "w", encoding="utf-8") as f:",
"       json.dump(unified_list, f, ensure_ascii=False, indent=2)",
"   ",
"   print(f"\nüéâ Unificazione completata!")",
"   print(f"   Totale URL unici: {len(unified_list)}")",
"   print(f"   Salvati in: {OUTPUT_FILE}")

if __name__ == "__main__":",
"   main()